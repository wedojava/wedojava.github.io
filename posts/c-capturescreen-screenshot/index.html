<!DOCTYPE html>
<html lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="wedojava" />
	
	
	
	<title>Capture Screen or Screen Shot [C/C&#43;&#43; win32 api] ｜ 回风舞雪</title>
	
    
    
    <meta name="description" content=" Reference:
 Screenshot C&#43;&#43; win32 api https://gist.github.com/rdp/9821698 How can I take a screenshot and save it as JPEG on Windows? Converting a BMP Image to a PNG Image  Retrieving the Class Identifier for an Encoder   c&#43;&#43;链接时，无法解析的外部符号 _GdipAlloc等一系列报错   I implemented screen shot from two methods, this post decription the way use [C/C&#43;&#43; win32 api] to get it, Python edition for screen shot is more easy than this, I&amp;rsquo;ll release it late also.
" />
    

    
    
    <meta name="keywords" content="Hugo, theme, zozo, huifeng" />
    

	
    
    <link rel="shortcut icon" href="https://huifeng.me/images/favicon.ico" />

    <link rel="stylesheet" type="text/css" media="screen" href="https://huifeng.mecss/normalize.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://huifeng.me/css/zozo.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://huifeng.me/css/search.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://huifeng.me/css/highlight.css" />

    
    
</head>


<body>
    <div class="main animate__animated animate__fadeInDown">
        <div class="nav_container animated fadeInDown">
    <div class="site_nav" id="site_nav">
        <ul>
            
            <li>
                <a href="/">Home</a>
            </li>
            
            <li>
                <a href="/posts/">Archive</a>
            </li>
            
            <li>
                <a href="/tags/">Tags</a>
            </li>
            
            <li>
                <a href="/about/">About</a>
            </li>
            
        </ul>
    </div>
    <div class="menu_icon">
        <a id="menu_icon"><i class="ri-menu-line"></i></a>
    </div>
</div>
        <div class="header animated fadeInDown">
    <div class="site_title_container">
        <div class="site_title">
            <h1>
                <a href="https://huifeng.me">
                    <span>回风舞雪</span>
                </a>
            </h1>
        </div>
        <div class="description">
            <p class="sub_title">Love My Love</p>
            <div class="my_socials">
                
                
                <a href="https://github.com/wedojava" title="github" target="_blank"><i class="ri-github-fill"></i></a>
                
                
                
                <a href="https://weibo.com/wedojava" title="weibo" target="_blank"><i class="ri-weibo-fill"></i></a>
                
                
                <a href="https://huifeng.me/index.xml" type="application/rss+xml" title="rss" target="_blank"><i
                        class="ri-rss-fill"></i></a>
            </div>
        </div>
    </div>
</div>
        <div class="content">
            <div class="post_page">
                <div class="post animate__animated animate__fadeInDown">
                    <div class="post_title post_detail_title">
                        <h2><a href='/posts/c-capturescreen-screenshot/'>Capture Screen or Screen Shot [C/C&#43;&#43; win32 api]</a></h2>
                        <span class="date">2019.08.24</span>
                    </div>
                    <div class="post_content markdown"><blockquote>
<p>Reference:</p>
<ul>
<li><a href="https://causeyourestuck.io/2016/01/12/screenshot-c-win32-api/">Screenshot C++ win32 api</a></li>
<li><a href="https://gist.github.com/rdp/9821698">https://gist.github.com/rdp/9821698</a></li>
<li><a href="https://stackoverflow.com/questions/997175/how-can-i-take-a-screenshot-and-save-it-as-jpeg-on-windows">How can I take a screenshot and save it as JPEG on Windows?</a></li>
<li><a href="https://docs.microsoft.com/en-us/windows/win32/gdiplus/-gdiplus-converting-a-bmp-image-to-a-png-image-use">Converting a BMP Image to a PNG Image</a>
<ul>
<li><a href="https://docs.microsoft.com/en-us/windows/win32/gdiplus/-gdiplus-retrieving-the-class-identifier-for-an-encoder-use">Retrieving the Class Identifier for an Encoder</a></li>
</ul>
</li>
<li><a href="https://blog.csdn.net/sqn614/article/details/71105117">c++链接时，无法解析的外部符号 _GdipAlloc等一系列报错</a></li>
</ul>
</blockquote>
<p>I implemented screen shot from two methods, this post decription the way use [C/C++ win32 api] to get it, Python edition for screen shot is more easy than this, I&rsquo;ll release it late also.</p>
<h1 id="just-tips-i-got-via-this-projects-developing">Just tips I got via this project&rsquo;s developing!</h1>
<ul>
<li>Get Screen&rsquo;s Resolution
<ul>
<li>method one</li>
</ul>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++"><span class="n">INT</span> <span class="n">width</span> <span class="o">=</span> <span class="n">GetSystemMetrics</span><span class="p">(</span><span class="n">SM_CXSCREEN</span><span class="p">);</span>  <span class="c1">// 屏幕宽
</span><span class="c1"></span><span class="n">INT</span> <span class="n">height</span> <span class="o">=</span> <span class="n">GetSystemMetrics</span><span class="p">(</span><span class="n">SM_CYSCREEN</span><span class="p">);</span>  <span class="c1">// 屏幕高
</span></code></pre></div><pre><code>+ method two
</code></pre>
<div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++"><span class="n">HDC</span> <span class="n">hScreen</span> <span class="o">=</span> <span class="n">GetDC</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="n">RECT</span> <span class="n">rect</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">GetDeviceCaps</span><span class="p">(</span><span class="n">hScreen</span><span class="p">,</span> <span class="n">HORZRES</span><span class="p">),</span> <span class="n">GetDeviceCaps</span><span class="p">(</span><span class="n">hScreen</span><span class="p">,</span> <span class="n">VERTRES</span><span class="p">)</span> <span class="p">};</span>
<span class="n">POINT</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
<span class="n">a</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">LPRECT</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rect</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">;</span>
<span class="n">a</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">LPRECT</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rect</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">top</span><span class="p">;</span>
<span class="n">b</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">LPRECT</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rect</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">;</span>
<span class="n">b</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">LPRECT</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rect</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">bottom</span><span class="p">;</span>
</code></pre></div><ul>
<li>Add <code>#pragma comment(lib,&quot;gdiplus.lib&quot;)</code> to fix link error: <code>error LNK2019: unresolved external symbol _GdipAlloc@4</code> etc.</li>
<li>Better way to connect string:</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp"></span><span class="n">sprintf_s</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s">&#34;%s%s%s&#34;</span><span class="p">,</span> <span class="s">&#34;dirPath&#34;</span><span class="p">,</span> <span class="s">&#34;filename&#34;</span><span class="p">,</span> <span class="s">&#34;.bmp&#34;</span><span class="p">);</span>
</code></pre></div><ul>
<li>Convert CHAR* to WCHAR* (char* to wchar_t *):</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp"></span><span class="kt">wchar_t</span><span class="o">*</span> <span class="n">wfilepath</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">wchar_t</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span>
<span class="n">swprintf</span><span class="p">(</span><span class="n">wfilepath</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="sa">L</span><span class="s">&#34;%hs&#34;</span><span class="p">,</span> <span class="s">&#34;filepath&#34;</span><span class="p">);</span>
</code></pre></div><h1 id="capture-screen">Capture Screen</h1>
<h2 id="one-quick-start">One quick start</h2>
<p>Refer to <a href="https://causeyourestuck.io/2016/01/12/screenshot-c-win32-api/">Screenshot C++ win32 api</a>, it is the quick and easy way to see while or not you can capture a screen by program C. Just run and paste to Paint. You can get achivement quickly and easy to get how to shot screen.</p>
<h2 id="another-way-to-get-it-method-one">Another way to get it (Method one)</h2>
<p>Refer to <a href="https://gist.github.com/rdp/9821698">https://gist.github.com/rdp/9821698</a>
I follow the gist replies, and fixed memory leak resulted above:
<strong>NOTICE：</strong> Set properties in visule studio [Configuration]-&gt;[General]-&gt;[Character Set]-&gt;<code>Use Multi-Byte Character Set</code></p>
<div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// compile this like g++ go2.c -lgdi32 [if you&#39;re using mingw]
</span><span class="c1"></span>
<span class="cp">#include</span> <span class="cpf">&lt;windows.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="c1">// Helper function to retrieve current position of file pointer:
</span><span class="c1"></span><span class="kr">inline</span> <span class="kt">int</span> <span class="nf">GetFilePointer</span><span class="p">(</span><span class="n">HANDLE</span> <span class="n">FileHandle</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">SetFilePointer</span><span class="p">(</span><span class="n">FileHandle</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">FILE_CURRENT</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">//---------------------------------------------------------------------------
</span><span class="c1"></span>
<span class="c1">// Screenshot
</span><span class="c1">//    -&gt; FileName: Name of file to save screenshot to
</span><span class="c1">//    -&gt; lpDDS: DirectDraw surface to capture
</span><span class="c1">//    &lt;- Result: Success
</span><span class="c1">//
</span><span class="c1"></span><span class="k">extern</span> <span class="kt">bool</span> <span class="nf">SaveBMPFile</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">filename</span><span class="p">,</span> <span class="n">HBITMAP</span> <span class="n">bitmap</span><span class="p">,</span> <span class="n">HDC</span> <span class="n">bitmapDC</span><span class="p">,</span> <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">bool</span> <span class="n">Success</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="n">HDC</span> <span class="n">SurfDC</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>        <span class="c1">// GDI-compatible device context for the surface
</span><span class="c1"></span>    <span class="n">HBITMAP</span> <span class="n">OffscrBmp</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="c1">// bitmap that is converted to a DIB
</span><span class="c1"></span>    <span class="n">HDC</span> <span class="n">OffscrDC</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>      <span class="c1">// offscreen DC that we can select OffscrBmp into
</span><span class="c1"></span>    <span class="n">LPBITMAPINFO</span> <span class="n">lpbi</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="c1">// bitmap format info; used by GetDIBits
</span><span class="c1"></span>    <span class="n">LPVOID</span> <span class="n">lpvBits</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>    <span class="c1">// pointer to bitmap bits array
</span><span class="c1"></span>    <span class="n">HANDLE</span> <span class="n">BmpFile</span> <span class="o">=</span> <span class="n">INVALID_HANDLE_VALUE</span><span class="p">;</span>    <span class="c1">// destination .bmp file
</span><span class="c1"></span>    <span class="n">BITMAPFILEHEADER</span> <span class="n">bmfh</span><span class="p">;</span>  <span class="c1">// .bmp file header
</span><span class="c1"></span>
    <span class="c1">// We need an HBITMAP to convert it to a DIB:
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">((</span><span class="n">OffscrBmp</span> <span class="o">=</span> <span class="n">CreateCompatibleBitmap</span><span class="p">(</span><span class="n">bitmapDC</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">// The bitmap is empty, so let&#39;s copy the contents of the surface to it.
</span><span class="c1"></span>    <span class="c1">// For that we need to select it into a device context. We create one.
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">((</span><span class="n">OffscrDC</span> <span class="o">=</span> <span class="n">CreateCompatibleDC</span><span class="p">(</span><span class="n">bitmapDC</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">// Select OffscrBmp into OffscrDC:
</span><span class="c1"></span>    <span class="n">HBITMAP</span> <span class="n">OldBmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">HBITMAP</span><span class="p">)</span><span class="n">SelectObject</span><span class="p">(</span><span class="n">OffscrDC</span><span class="p">,</span> <span class="n">OffscrBmp</span><span class="p">);</span>

    <span class="c1">// Now we can copy the contents of the surface to the offscreen bitmap:
</span><span class="c1"></span>    <span class="n">BitBlt</span><span class="p">(</span><span class="n">OffscrDC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">bitmapDC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SRCCOPY</span><span class="p">);</span>

    <span class="c1">// GetDIBits requires format info about the bitmap. We can have GetDIBits
</span><span class="c1"></span>    <span class="c1">// fill a structure with that info if we pass a NULL pointer for lpvBits:
</span><span class="c1"></span>    <span class="c1">// Reserve memory for bitmap info (BITMAPINFOHEADER + largest possible
</span><span class="c1"></span>    <span class="c1">// palette):
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">((</span><span class="n">lpbi</span> <span class="o">=</span> <span class="p">(</span><span class="n">LPBITMAPINFO</span><span class="p">)(</span><span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="k">sizeof</span><span class="p">(</span><span class="n">BITMAPINFOHEADER</span><span class="p">)</span> <span class="o">+</span> <span class="mi">256</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">RGBQUAD</span><span class="p">)]))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>


    <span class="n">ZeroMemory</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lpbi</span><span class="o">-&gt;</span><span class="n">bmiHeader</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">BITMAPINFOHEADER</span><span class="p">));</span>
    <span class="n">lpbi</span><span class="o">-&gt;</span><span class="n">bmiHeader</span><span class="p">.</span><span class="n">biSize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">BITMAPINFOHEADER</span><span class="p">);</span>
    <span class="c1">// Get info but first de-select OffscrBmp because GetDIBits requires it:
</span><span class="c1"></span>    <span class="n">SelectObject</span><span class="p">(</span><span class="n">OffscrDC</span><span class="p">,</span> <span class="n">OldBmp</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">GetDIBits</span><span class="p">(</span><span class="n">OffscrDC</span><span class="p">,</span> <span class="n">OffscrBmp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">lpbi</span><span class="p">,</span> <span class="n">DIB_RGB_COLORS</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">// Reserve memory for bitmap bits:
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">((</span><span class="n">lpvBits</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">lpbi</span><span class="o">-&gt;</span><span class="n">bmiHeader</span><span class="p">.</span><span class="n">biSizeImage</span><span class="p">])</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">// Have GetDIBits convert OffscrBmp to a DIB (device-independent bitmap):
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">GetDIBits</span><span class="p">(</span><span class="n">OffscrDC</span><span class="p">,</span> <span class="n">OffscrBmp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">lpvBits</span><span class="p">,</span> <span class="n">lpbi</span><span class="p">,</span> <span class="n">DIB_RGB_COLORS</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">// Create a file to save the DIB to:
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">((</span><span class="n">BmpFile</span> <span class="o">=</span> <span class="n">CreateFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span>
        <span class="n">GENERIC_WRITE</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
        <span class="n">CREATE_ALWAYS</span><span class="p">,</span>
        <span class="n">FILE_ATTRIBUTE_NORMAL</span><span class="p">,</span>
        <span class="nb">NULL</span><span class="p">))</span> <span class="o">==</span> <span class="n">INVALID_HANDLE_VALUE</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">DWORD</span> <span class="n">Written</span><span class="p">;</span>    <span class="c1">// number of bytes written by WriteFile
</span><span class="c1"></span>
    <span class="c1">// Write a file header to the file:
</span><span class="c1"></span>    <span class="n">bmfh</span><span class="p">.</span><span class="n">bfType</span> <span class="o">=</span> <span class="mi">19778</span><span class="p">;</span>        <span class="c1">// &#39;BM&#39;
</span><span class="c1"></span>    <span class="c1">// bmfh.bfSize = ???        // we&#39;ll write that later
</span><span class="c1"></span>    <span class="n">bmfh</span><span class="p">.</span><span class="n">bfReserved1</span> <span class="o">=</span> <span class="n">bmfh</span><span class="p">.</span><span class="n">bfReserved2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="c1">// bmfh.bfOffBits = ???     // we&#39;ll write that later
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">WriteFile</span><span class="p">(</span><span class="n">BmpFile</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">bmfh</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">bmfh</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">Written</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">Written</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">bmfh</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">// Write BITMAPINFOHEADER to the file:
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">WriteFile</span><span class="p">(</span><span class="n">BmpFile</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lpbi</span><span class="o">-&gt;</span><span class="n">bmiHeader</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">BITMAPINFOHEADER</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">Written</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">Written</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">BITMAPINFOHEADER</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">// Calculate size of palette:
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">PalEntries</span><span class="p">;</span>
    <span class="c1">// 16-bit or 32-bit bitmaps require bit masks:
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">lpbi</span><span class="o">-&gt;</span><span class="n">bmiHeader</span><span class="p">.</span><span class="n">biCompression</span> <span class="o">==</span> <span class="n">BI_BITFIELDS</span><span class="p">)</span>
        <span class="n">PalEntries</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="k">else</span>
        <span class="c1">// bitmap is palettized?
</span><span class="c1"></span>        <span class="n">PalEntries</span> <span class="o">=</span> <span class="p">(</span><span class="n">lpbi</span><span class="o">-&gt;</span><span class="n">bmiHeader</span><span class="p">.</span><span class="n">biBitCount</span> <span class="o">&lt;=</span> <span class="mi">8</span><span class="p">)</span> <span class="o">?</span>
        <span class="c1">// 2^biBitCount palette entries max.:
</span><span class="c1"></span>        <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">lpbi</span><span class="o">-&gt;</span><span class="n">bmiHeader</span><span class="p">.</span><span class="n">biBitCount</span><span class="p">)</span>
        <span class="c1">// bitmap is TrueColor -&gt; no palette:
</span><span class="c1"></span>        <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="c1">// If biClrUsed use only biClrUsed palette entries:
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">lpbi</span><span class="o">-&gt;</span><span class="n">bmiHeader</span><span class="p">.</span><span class="n">biClrUsed</span><span class="p">)</span>
        <span class="n">PalEntries</span> <span class="o">=</span> <span class="n">lpbi</span><span class="o">-&gt;</span><span class="n">bmiHeader</span><span class="p">.</span><span class="n">biClrUsed</span><span class="p">;</span>

    <span class="c1">// Write palette to the file:
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">PalEntries</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">WriteFile</span><span class="p">(</span><span class="n">BmpFile</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lpbi</span><span class="o">-&gt;</span><span class="n">bmiColors</span><span class="p">,</span> <span class="n">PalEntries</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">RGBQUAD</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">Written</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">))</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">Written</span> <span class="o">&lt;</span> <span class="n">PalEntries</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">RGBQUAD</span><span class="p">))</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// The current position in the file (at the beginning of the bitmap bits)
</span><span class="c1"></span>    <span class="c1">// will be saved to the BITMAPFILEHEADER:
</span><span class="c1"></span>    <span class="n">bmfh</span><span class="p">.</span><span class="n">bfOffBits</span> <span class="o">=</span> <span class="n">GetFilePointer</span><span class="p">(</span><span class="n">BmpFile</span><span class="p">);</span>

    <span class="c1">// Write bitmap bits to the file:
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">WriteFile</span><span class="p">(</span><span class="n">BmpFile</span><span class="p">,</span> <span class="n">lpvBits</span><span class="p">,</span> <span class="n">lpbi</span><span class="o">-&gt;</span><span class="n">bmiHeader</span><span class="p">.</span><span class="n">biSizeImage</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Written</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">Written</span> <span class="o">&lt;</span> <span class="n">lpbi</span><span class="o">-&gt;</span><span class="n">bmiHeader</span><span class="p">.</span><span class="n">biSizeImage</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="c1">// The current pos. in the file is the final file size and will be saved:
</span><span class="c1"></span>    <span class="n">bmfh</span><span class="p">.</span><span class="n">bfSize</span> <span class="o">=</span> <span class="n">GetFilePointer</span><span class="p">(</span><span class="n">BmpFile</span><span class="p">);</span>

    <span class="c1">// We have all the info for the file header. Save the updated version:
</span><span class="c1"></span>    <span class="n">SetFilePointer</span><span class="p">(</span><span class="n">BmpFile</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">FILE_BEGIN</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">WriteFile</span><span class="p">(</span><span class="n">BmpFile</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">bmfh</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">bmfh</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">Written</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">Written</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">bmfh</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">delete</span><span class="p">[]</span> <span class="n">lpvBits</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>



<span class="kt">bool</span> <span class="nf">ScreenCapture</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">filename</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// get a DC compat. w/ the screen
</span><span class="c1"></span>    <span class="n">HDC</span> <span class="n">hDc</span> <span class="o">=</span> <span class="n">CreateCompatibleDC</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    <span class="c1">// make a bmp in memory to store the capture in
</span><span class="c1"></span>    <span class="n">HBITMAP</span> <span class="n">hBmp</span> <span class="o">=</span> <span class="n">CreateCompatibleBitmap</span><span class="p">(</span><span class="n">GetDC</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">);</span>

    <span class="c1">// join em up
</span><span class="c1"></span>    <span class="n">SelectObject</span><span class="p">(</span><span class="n">hDc</span><span class="p">,</span> <span class="n">hBmp</span><span class="p">);</span>

    <span class="c1">// copy from the screen to my bitmap
</span><span class="c1"></span>    <span class="n">BitBlt</span><span class="p">(</span><span class="n">hDc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">GetDC</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">SRCCOPY</span><span class="p">);</span>

    <span class="c1">// save my bitmap
</span><span class="c1"></span>    <span class="kt">bool</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">SaveBMPFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">hBmp</span><span class="p">,</span> <span class="n">hDc</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">);</span>

    <span class="c1">// free the bitmap memory
</span><span class="c1"></span>    <span class="n">DeleteObject</span><span class="p">(</span><span class="n">hBmp</span><span class="p">);</span>
    <span class="n">DeleteDC</span><span class="p">(</span><span class="n">hDc</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">filename</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#34;testScreenCap.bmp&#34;</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">width</span> <span class="o">=</span> <span class="n">GetSystemMetrics</span><span class="p">(</span><span class="n">SM_CXSCREEN</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">height</span> <span class="o">=</span> <span class="n">GetSystemMetrics</span><span class="p">(</span><span class="n">SM_CYSCREEN</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">ifSuccess</span> <span class="o">=</span> <span class="n">ScreenCapture</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">filename</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ifSuccess</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;wrote to testScreenCap.bmp&#34;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><h2 id="another-way-to-get-it-method-two">Another way to get it (Method two)</h2>
<p><strong>NOTICE：</strong> Set [Configuration]-&gt;[General]-&gt;[Character Set]-&gt;<code>Use Multi-Byte Character Set</code></p>
<div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;windows.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">CaptureImage</span><span class="p">(</span><span class="n">HWND</span> <span class="n">hWnd</span><span class="p">,</span> <span class="n">CHAR</span><span class="o">*</span> <span class="n">dirPath</span><span class="p">,</span> <span class="n">CHAR</span><span class="o">*</span> <span class="n">filename</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">CHAR</span> <span class="n">path</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#34;D:</span><span class="se">\\</span><span class="s">&#34;</span><span class="p">;</span>
    <span class="n">CHAR</span> <span class="n">filename</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#34;hello&#34;</span><span class="p">;</span>
    <span class="n">CaptureImage</span><span class="p">(</span><span class="n">GetDesktopWindow</span><span class="p">(),</span> <span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="p">);</span> <span class="c1">// 保存为 E:hello.bmp
</span><span class="c1"></span>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**
</span><span class="cm"> * GDI 截取指定窗口
</span><span class="cm"> *
</span><span class="cm"> * 参数 hwnd   要截屏的窗口句柄
</span><span class="cm"> * 参数 dirPath    截图存放目录
</span><span class="cm"> * 参数 filename 截图名称
</span><span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">CaptureImage</span><span class="p">(</span><span class="n">HWND</span> <span class="n">hwnd</span><span class="p">,</span> <span class="n">CHAR</span> <span class="o">*</span> <span class="n">dirPath</span><span class="p">,</span> <span class="n">CHAR</span> <span class="o">*</span> <span class="n">filename</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">HDC</span> <span class="n">mdc</span><span class="p">;</span>
    <span class="n">HBITMAP</span> <span class="n">hbmp</span><span class="p">;</span>
    <span class="n">CHAR</span> <span class="n">FilePath</span><span class="p">[</span><span class="n">MAX_PATH</span><span class="p">];</span>
    <span class="n">HDC</span> <span class="n">hdcScreen</span><span class="p">;</span>
    <span class="n">HDC</span> <span class="n">hdcWindow</span><span class="p">;</span>
    <span class="n">HDC</span> <span class="n">hdcMemDC</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">HBITMAP</span> <span class="n">hbmScreen</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">BITMAP</span> <span class="n">bmpScreen</span><span class="p">;</span>
    <span class="n">RECT</span> <span class="n">rcClient</span><span class="p">;</span>
    <span class="n">BITMAPFILEHEADER</span>   <span class="n">bmfHeader</span><span class="p">;</span>
    <span class="n">BITMAPINFOHEADER</span>   <span class="n">bi</span><span class="p">;</span>
    <span class="n">DWORD</span> <span class="n">dwBmpSize</span><span class="p">;</span>
    <span class="n">HANDLE</span> <span class="n">hDIB</span><span class="p">;</span>
    <span class="n">CHAR</span><span class="o">*</span> <span class="n">lpbitmap</span><span class="p">;</span>
    <span class="n">HANDLE</span> <span class="n">hFile</span><span class="p">;</span>
    <span class="n">DWORD</span> <span class="n">dwSizeofDIB</span><span class="p">;</span>
    <span class="n">DWORD</span> <span class="n">dwBytesWritten</span><span class="p">;</span>

    <span class="n">hdcScreen</span> <span class="o">=</span> <span class="n">GetDC</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span> <span class="c1">// 全屏幕DC
</span><span class="c1"></span>    <span class="n">hdcWindow</span> <span class="o">=</span> <span class="n">GetDC</span><span class="p">(</span><span class="n">hwnd</span><span class="p">);</span> <span class="c1">// 截图目标窗口DC
</span><span class="c1"></span>
    <span class="c1">// 创建兼容内存DC
</span><span class="c1"></span>    <span class="n">hdcMemDC</span> <span class="o">=</span> <span class="n">CreateCompatibleDC</span><span class="p">(</span><span class="n">hdcWindow</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hdcMemDC</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">goto</span> <span class="n">done</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// 获取客户端区域用于计算大小
</span><span class="c1"></span>    <span class="n">GetClientRect</span><span class="p">(</span><span class="n">hwnd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">rcClient</span><span class="p">);</span>

    <span class="c1">// 设置延展模式
</span><span class="c1"></span>    <span class="n">SetStretchBltMode</span><span class="p">(</span><span class="n">hdcWindow</span><span class="p">,</span> <span class="n">HALFTONE</span><span class="p">);</span>

    <span class="c1">// 来源 DC 是整个屏幕而目标 DC 是当前的窗口 (HWND)
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">StretchBlt</span><span class="p">(</span><span class="n">hdcWindow</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">rcClient</span><span class="p">.</span><span class="n">right</span><span class="p">,</span> <span class="n">rcClient</span><span class="p">.</span><span class="n">bottom</span><span class="p">,</span>
        <span class="n">hdcScreen</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">GetSystemMetrics</span><span class="p">(</span><span class="n">SM_CXSCREEN</span><span class="p">),</span>
        <span class="n">GetSystemMetrics</span><span class="p">(</span><span class="n">SM_CYSCREEN</span><span class="p">),</span>
        <span class="n">SRCCOPY</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">goto</span> <span class="n">done</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// 通过窗口DC 创建一个兼容位图
</span><span class="c1"></span>    <span class="n">hbmScreen</span> <span class="o">=</span> <span class="n">CreateCompatibleBitmap</span><span class="p">(</span>
        <span class="n">hdcWindow</span><span class="p">,</span>
        <span class="n">rcClient</span><span class="p">.</span><span class="n">right</span> <span class="o">-</span> <span class="n">rcClient</span><span class="p">.</span><span class="n">left</span><span class="p">,</span>
        <span class="n">rcClient</span><span class="p">.</span><span class="n">bottom</span> <span class="o">-</span> <span class="n">rcClient</span><span class="p">.</span><span class="n">top</span>
    <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hbmScreen</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">goto</span> <span class="n">done</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// 将位图块传送到我们兼容的内存DC中
</span><span class="c1"></span>    <span class="n">SelectObject</span><span class="p">(</span><span class="n">hdcMemDC</span><span class="p">,</span> <span class="n">hbmScreen</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">BitBlt</span><span class="p">(</span>
        <span class="n">hdcMemDC</span><span class="p">,</span>   <span class="c1">// 目的DC
</span><span class="c1"></span>        <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>        <span class="c1">// 目的DC的 x,y 坐标
</span><span class="c1"></span>        <span class="n">rcClient</span><span class="p">.</span><span class="n">right</span> <span class="o">-</span> <span class="n">rcClient</span><span class="p">.</span><span class="n">left</span><span class="p">,</span> <span class="n">rcClient</span><span class="p">.</span><span class="n">bottom</span> <span class="o">-</span> <span class="n">rcClient</span><span class="p">.</span><span class="n">top</span><span class="p">,</span> <span class="c1">// 目的 DC 的宽高
</span><span class="c1"></span>        <span class="n">hdcWindow</span><span class="p">,</span>  <span class="c1">// 来源DC
</span><span class="c1"></span>        <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>        <span class="c1">// 来源DC的 x,y 坐标
</span><span class="c1"></span>        <span class="n">SRCCOPY</span><span class="p">))</span>   <span class="c1">// 粘贴方式
</span><span class="c1"></span>    <span class="p">{</span>
        <span class="k">goto</span> <span class="n">done</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// 获取位图信息并存放在 bmpScreen 中
</span><span class="c1"></span>    <span class="n">GetObject</span><span class="p">(</span><span class="n">hbmScreen</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">BITMAP</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">bmpScreen</span><span class="p">);</span>

    <span class="n">bi</span><span class="p">.</span><span class="n">biSize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">BITMAPINFOHEADER</span><span class="p">);</span>
    <span class="n">bi</span><span class="p">.</span><span class="n">biWidth</span> <span class="o">=</span> <span class="n">bmpScreen</span><span class="p">.</span><span class="n">bmWidth</span><span class="p">;</span>
    <span class="n">bi</span><span class="p">.</span><span class="n">biHeight</span> <span class="o">=</span> <span class="n">bmpScreen</span><span class="p">.</span><span class="n">bmHeight</span><span class="p">;</span>
    <span class="n">bi</span><span class="p">.</span><span class="n">biPlanes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">bi</span><span class="p">.</span><span class="n">biBitCount</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
    <span class="n">bi</span><span class="p">.</span><span class="n">biCompression</span> <span class="o">=</span> <span class="n">BI_RGB</span><span class="p">;</span>
    <span class="n">bi</span><span class="p">.</span><span class="n">biSizeImage</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">bi</span><span class="p">.</span><span class="n">biXPelsPerMeter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">bi</span><span class="p">.</span><span class="n">biYPelsPerMeter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">bi</span><span class="p">.</span><span class="n">biClrUsed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">bi</span><span class="p">.</span><span class="n">biClrImportant</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">dwBmpSize</span> <span class="o">=</span> <span class="p">((</span><span class="n">bmpScreen</span><span class="p">.</span><span class="n">bmWidth</span> <span class="o">*</span> <span class="n">bi</span><span class="p">.</span><span class="n">biBitCount</span> <span class="o">+</span> <span class="mi">31</span><span class="p">)</span> <span class="o">/</span> <span class="mi">32</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">bmpScreen</span><span class="p">.</span><span class="n">bmHeight</span><span class="p">;</span>

    <span class="c1">// 在 32-bit Windows 系统上, GlobalAlloc 和 LocalAlloc 是由 HeapAlloc 封装来的
</span><span class="c1"></span>    <span class="c1">// handle 指向进程默认的堆. 所以开销比 HeapAlloc 要大
</span><span class="c1"></span>    <span class="n">hDIB</span> <span class="o">=</span> <span class="n">GlobalAlloc</span><span class="p">(</span><span class="n">GHND</span><span class="p">,</span> <span class="n">dwBmpSize</span><span class="p">);</span>
    <span class="n">lpbitmap</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">GlobalLock</span><span class="p">(</span><span class="n">hDIB</span><span class="p">);</span>

    <span class="c1">// 获取兼容位图的位并且拷贝结果到一个 lpbitmap 中.
</span><span class="c1"></span>    <span class="n">GetDIBits</span><span class="p">(</span>
        <span class="n">hdcWindow</span><span class="p">,</span>  <span class="c1">// 设备环境句柄
</span><span class="c1"></span>        <span class="n">hbmScreen</span><span class="p">,</span>  <span class="c1">// 位图句柄
</span><span class="c1"></span>        <span class="mi">0</span><span class="p">,</span>          <span class="c1">// 指定检索的第一个扫描线
</span><span class="c1"></span>        <span class="p">(</span><span class="n">UINT</span><span class="p">)</span><span class="n">bmpScreen</span><span class="p">.</span><span class="n">bmHeight</span><span class="p">,</span> <span class="c1">// 指定检索的扫描线数
</span><span class="c1"></span>        <span class="n">lpbitmap</span><span class="p">,</span>   <span class="c1">// 指向用来检索位图数据的缓冲区的指针
</span><span class="c1"></span>        <span class="p">(</span><span class="n">BITMAPINFO</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span> <span class="n">bi</span><span class="p">,</span> <span class="c1">// 该结构体保存位图的数据格式
</span><span class="c1"></span>        <span class="n">DIB_RGB_COLORS</span> <span class="c1">// 颜色表由红、绿、蓝（RGB）三个直接值构成
</span><span class="c1"></span>    <span class="p">);</span>


    <span class="n">wsprintf</span><span class="p">(</span><span class="n">FilePath</span><span class="p">,</span> <span class="s">&#34;%s\%s.bmp&#34;</span><span class="p">,</span> <span class="n">dirPath</span><span class="p">,</span> <span class="n">filename</span><span class="p">);</span>

    <span class="c1">// 创建一个文件来保存文件截图
</span><span class="c1"></span>    <span class="n">hFile</span> <span class="o">=</span> <span class="n">CreateFile</span><span class="p">(</span>
        <span class="n">FilePath</span><span class="p">,</span>
        <span class="n">GENERIC_WRITE</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="nb">NULL</span><span class="p">,</span>
        <span class="n">CREATE_ALWAYS</span><span class="p">,</span>
        <span class="n">FILE_ATTRIBUTE_NORMAL</span><span class="p">,</span>
        <span class="nb">NULL</span>
    <span class="p">);</span>

    <span class="c1">// 将 图片头(headers)的大小, 加上位图的大小来获得整个文件的大小
</span><span class="c1"></span>    <span class="n">dwSizeofDIB</span> <span class="o">=</span> <span class="n">dwBmpSize</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">BITMAPFILEHEADER</span><span class="p">)</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">BITMAPINFOHEADER</span><span class="p">);</span>

    <span class="c1">// 设置 Offset 偏移至位图的位(bitmap bits)实际开始的地方
</span><span class="c1"></span>    <span class="n">bmfHeader</span><span class="p">.</span><span class="n">bfOffBits</span> <span class="o">=</span> <span class="p">(</span><span class="n">DWORD</span><span class="p">)</span><span class="k">sizeof</span><span class="p">(</span><span class="n">BITMAPFILEHEADER</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">DWORD</span><span class="p">)</span><span class="k">sizeof</span><span class="p">(</span><span class="n">BITMAPINFOHEADER</span><span class="p">);</span>

    <span class="c1">// 文件大小
</span><span class="c1"></span>    <span class="n">bmfHeader</span><span class="p">.</span><span class="n">bfSize</span> <span class="o">=</span> <span class="n">dwSizeofDIB</span><span class="p">;</span>

    <span class="c1">// 位图的 bfType 必须是字符串 &#34;BM&#34;
</span><span class="c1"></span>    <span class="n">bmfHeader</span><span class="p">.</span><span class="n">bfType</span> <span class="o">=</span> <span class="mh">0x4D42</span><span class="p">;</span> <span class="c1">//BM   
</span><span class="c1"></span>
    <span class="n">dwBytesWritten</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">WriteFile</span><span class="p">(</span><span class="n">hFile</span><span class="p">,</span> <span class="p">(</span><span class="n">LPSTR</span><span class="p">)</span><span class="o">&amp;</span> <span class="n">bmfHeader</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">BITMAPFILEHEADER</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">dwBytesWritten</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="n">WriteFile</span><span class="p">(</span><span class="n">hFile</span><span class="p">,</span> <span class="p">(</span><span class="n">LPSTR</span><span class="p">)</span><span class="o">&amp;</span> <span class="n">bi</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">BITMAPINFOHEADER</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">dwBytesWritten</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="n">WriteFile</span><span class="p">(</span><span class="n">hFile</span><span class="p">,</span> <span class="p">(</span><span class="n">LPSTR</span><span class="p">)</span><span class="n">lpbitmap</span><span class="p">,</span> <span class="n">dwBmpSize</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dwBytesWritten</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="c1">// 解锁堆内存并释放
</span><span class="c1"></span>    <span class="n">GlobalUnlock</span><span class="p">(</span><span class="n">hDIB</span><span class="p">);</span>
    <span class="n">GlobalFree</span><span class="p">(</span><span class="n">hDIB</span><span class="p">);</span>

    <span class="c1">// 关闭文件句柄
</span><span class="c1"></span>    <span class="n">CloseHandle</span><span class="p">(</span><span class="n">hFile</span><span class="p">);</span>

    <span class="c1">// 清理资源
</span><span class="c1"></span><span class="nl">done</span><span class="p">:</span>
    <span class="n">DeleteObject</span><span class="p">(</span><span class="n">hbmScreen</span><span class="p">);</span>
    <span class="n">DeleteObject</span><span class="p">(</span><span class="n">hdcMemDC</span><span class="p">);</span>
    <span class="n">ReleaseDC</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">hdcScreen</span><span class="p">);</span>
    <span class="n">ReleaseDC</span><span class="p">(</span><span class="n">hwnd</span><span class="p">,</span> <span class="n">hdcWindow</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><h2 id="convert-bmp-to-jpg-or-png">Convert BMP to JPG or PNG</h2>
<p>Usefull cases:</p>
<ul>
<li><a href="https://stackoverflow.com/questions/997175/how-can-i-take-a-screenshot-and-save-it-as-jpeg-on-windows">How can I take a screenshot and save it as JPEG on Windows?</a></li>
<li><a href="https://docs.microsoft.com/en-us/windows/win32/gdiplus/-gdiplus-converting-a-bmp-image-to-a-png-image-use">Converting a BMP Image to a PNG Image</a>
<ul>
<li><a href="https://docs.microsoft.com/en-us/windows/win32/gdiplus/-gdiplus-retrieving-the-class-identifier-for-an-encoder-use">Retrieving the Class Identifier for an Encoder</a></li>
</ul>
</li>
<li><a href="https://blog.csdn.net/sqn614/article/details/71105117">c++链接时，无法解析的外部符号 _GdipAlloc等一系列报错</a>
<ul>
<li>After two cases above coded, link error like <code>referenced in function &quot;public: static void * __cdecl Gdiplus::GdiplusBase::operator new(unsigned int)&quot; (??2GdiplusBase@Gdiplus@@SAPAXI@Z)</code> occured, you can code <code>#pragma comment(lib,&quot;gdiplus.lib&quot;)</code> at the top of your .cpp file to solve it.</li>
</ul>
</li>
</ul>
<p>if you wanna another format, exchange <code>image/png</code> to the list below:</p>
<ul>
<li>image/bmp</li>
<li>image/jpeg</li>
<li>image/gif</li>
<li>image/tiff</li>
<li>image/png</li>
</ul>
<p>Code for convert bmp to png:</p>
<div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#pragma comment(lib,&#34;gdiplus.lib&#34;)
</span><span class="cp">#include</span> <span class="cpf">&lt;windows.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;gdiplus.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">Gdiplus</span><span class="p">;</span>

<span class="n">INT</span> <span class="nf">GetEncoderClsid</span><span class="p">(</span><span class="k">const</span> <span class="n">WCHAR</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">CLSID</span><span class="o">*</span> <span class="n">pClsid</span><span class="p">);</span>  <span class="c1">// helper function
</span><span class="c1"></span><span class="n">INT</span> <span class="nf">convert2png</span><span class="p">();</span>

<span class="c1">// By reference:
</span><span class="c1">// https://docs.microsoft.com/en-us/windows/win32/gdiplus/-gdiplus-converting-a-bmp-image-to-a-png-image-use
</span><span class="c1"></span><span class="n">INT</span> <span class="nf">convert2png</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Initialize GDI+.
</span><span class="c1"></span>    <span class="n">GdiplusStartupInput</span> <span class="n">gdiplusStartupInput</span><span class="p">;</span>
    <span class="n">ULONG_PTR</span> <span class="n">gdiplusToken</span><span class="p">;</span>
    <span class="n">GdiplusStartup</span><span class="p">(</span><span class="o">&amp;</span><span class="n">gdiplusToken</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">gdiplusStartupInput</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="n">CLSID</span>   <span class="n">encoderClsid</span><span class="p">;</span>
    <span class="n">Status</span>  <span class="n">stat</span><span class="p">;</span>
    <span class="n">Image</span><span class="o">*</span> <span class="n">image</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Image</span><span class="p">(</span><span class="sa">L</span><span class="s">&#34;hello.bmp&#34;</span><span class="p">);</span>

    <span class="c1">// Get the CLSID of the PNG encoder.
</span><span class="c1"></span>    <span class="n">GetEncoderClsid</span><span class="p">(</span><span class="sa">L</span><span class="s">&#34;image/png&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">encoderClsid</span><span class="p">);</span>
    <span class="c1">//GetEncoderClsid(L&#34;image/jpeg&#34;, &amp;encoderClsid);
</span><span class="c1"></span>
    <span class="n">stat</span> <span class="o">=</span> <span class="n">image</span><span class="o">-&gt;</span><span class="n">Save</span><span class="p">(</span><span class="sa">L</span><span class="s">&#34;hello.png&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">encoderClsid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="c1">//stat = image-&gt;Save(L&#34;hello.jpg&#34;, &amp;encoderClsid, NULL);
</span><span class="c1"></span>
    <span class="k">if</span> <span class="p">(</span><span class="n">stat</span> <span class="o">==</span> <span class="n">Ok</span><span class="p">)</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;hello.png was saved successfully</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="k">else</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Failure: stat = %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">stat</span><span class="p">);</span>

    <span class="k">delete</span> <span class="n">image</span><span class="p">;</span>
    <span class="n">GdiplusShutdown</span><span class="p">(</span><span class="n">gdiplusToken</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="c1">// By reference:
</span><span class="c1">// https://docs.microsoft.com/en-us/windows/win32/gdiplus/-gdiplus-retrieving-the-class-identifier-for-an-encoder-use
</span><span class="c1"></span><span class="kt">int</span> <span class="nf">GetEncoderClsid</span><span class="p">(</span><span class="k">const</span> <span class="n">WCHAR</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">CLSID</span><span class="o">*</span> <span class="n">pClsid</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">UINT</span>  <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>          <span class="c1">// number of image encoders
</span><span class="c1"></span>    <span class="n">UINT</span>  <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>         <span class="c1">// size of the image encoder array in bytes
</span><span class="c1"></span>
    <span class="n">ImageCodecInfo</span><span class="o">*</span> <span class="n">pImageCodecInfo</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

    <span class="n">GetImageEncodersSize</span><span class="p">(</span><span class="o">&amp;</span><span class="n">num</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">size</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>  <span class="c1">// Failure
</span><span class="c1"></span>
    <span class="n">pImageCodecInfo</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImageCodecInfo</span><span class="o">*</span><span class="p">)(</span><span class="n">malloc</span><span class="p">(</span><span class="n">size</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pImageCodecInfo</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>  <span class="c1">// Failure
</span><span class="c1"></span>
    <span class="n">GetImageEncoders</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">pImageCodecInfo</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">UINT</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">num</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">wcscmp</span><span class="p">(</span><span class="n">pImageCodecInfo</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">MimeType</span><span class="p">,</span> <span class="n">format</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="o">*</span><span class="n">pClsid</span> <span class="o">=</span> <span class="n">pImageCodecInfo</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">Clsid</span><span class="p">;</span>
            <span class="n">free</span><span class="p">(</span><span class="n">pImageCodecInfo</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">j</span><span class="p">;</span>  <span class="c1">// Success
</span><span class="c1"></span>        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">free</span><span class="p">(</span><span class="n">pImageCodecInfo</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>  <span class="c1">// Failure
</span><span class="c1"></span><span class="p">}</span>
</code></pre></div><h2 id="my-final-result-code">My Final Result Code</h2>
<p>Here are some of my insights about official documents:</p>
<ol>
<li>Official document are often useful, such as my searching for convert bmp to jpg, the shortest and best code from microsoft docs.</li>
<li>Just refer inform posts, maybe it&rsquo;s a quick way to resolve our problem, but, we can knowing it, but don’t know why, only officical document can tell you all if you patience enough.</li>
</ol>
<p>For programe c/c++, for development environment differ, we also have to exhaust our effort to fix too many bugs, lost time for developing env, but not for developing business. So, share my env config here.</p>
<h2 id="my-development-environment-configuration">My Development environment configuration</h2>
<ol>
<li>Target Platform Version: 8.1</li>
<li>Platform Toolset:        Visual Studio 2015 - Windows XP (v140_xp)</li>
<li>Character Set:           Use Multi-Byte Character Set</li>
</ol>
<h2 id="complete-code">Complete code</h2>
<p>You can save the code below as a .cpp file to run, it can catpure your screen and save hello.bmp and hello.png files respectively.
Good luck!</p>
<div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#pragma comment(lib,&#34;gdiplus.lib&#34;)
</span><span class="cp">#include</span> <span class="cpf">&lt;windows.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;gdiplus.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">Gdiplus</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">CaptureImage</span><span class="p">(</span><span class="n">HWND</span> <span class="n">hWnd</span><span class="p">,</span> <span class="n">CHAR</span><span class="o">*</span> <span class="n">dirPath</span><span class="p">,</span> <span class="n">CHAR</span><span class="o">*</span> <span class="n">filename</span><span class="p">);</span>
<span class="n">INT</span> <span class="nf">GetEncoderClsid</span><span class="p">(</span><span class="k">const</span> <span class="n">WCHAR</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">CLSID</span><span class="o">*</span> <span class="n">pClsid</span><span class="p">);</span>  <span class="c1">// helper function
</span><span class="c1"></span><span class="n">INT</span> <span class="nf">convert2png</span><span class="p">();</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">CHAR</span> <span class="n">path</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#34;.</span><span class="se">\\</span><span class="s">&#34;</span><span class="p">;</span>
    <span class="n">CHAR</span> <span class="n">filename</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#34;hello&#34;</span><span class="p">;</span>
    <span class="n">CaptureImage</span><span class="p">(</span><span class="n">GetDesktopWindow</span><span class="p">(),</span> <span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="p">);</span> <span class="c1">// 保存为 E:hello.bmp
</span><span class="c1"></span>    <span class="n">convert2png</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="c1">// By reference:
</span><span class="c1">// https://docs.microsoft.com/en-us/windows/win32/gdiplus/-gdiplus-converting-a-bmp-image-to-a-png-image-use
</span><span class="c1"></span><span class="n">INT</span> <span class="nf">convert2png</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Initialize GDI+.
</span><span class="c1"></span>    <span class="n">GdiplusStartupInput</span> <span class="n">gdiplusStartupInput</span><span class="p">;</span>
    <span class="n">ULONG_PTR</span> <span class="n">gdiplusToken</span><span class="p">;</span>
    <span class="n">GdiplusStartup</span><span class="p">(</span><span class="o">&amp;</span><span class="n">gdiplusToken</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">gdiplusStartupInput</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="n">CLSID</span>   <span class="n">encoderClsid</span><span class="p">;</span>
    <span class="n">Status</span>  <span class="n">stat</span><span class="p">;</span>
    <span class="n">Image</span><span class="o">*</span> <span class="n">image</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Image</span><span class="p">(</span><span class="sa">L</span><span class="s">&#34;hello.bmp&#34;</span><span class="p">);</span>

    <span class="c1">// Get the CLSID of the PNG encoder.
</span><span class="c1"></span>    <span class="n">GetEncoderClsid</span><span class="p">(</span><span class="sa">L</span><span class="s">&#34;image/png&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">encoderClsid</span><span class="p">);</span>
    <span class="c1">//GetEncoderClsid(L&#34;image/jpeg&#34;, &amp;encoderClsid);
</span><span class="c1"></span>
    <span class="n">stat</span> <span class="o">=</span> <span class="n">image</span><span class="o">-&gt;</span><span class="n">Save</span><span class="p">(</span><span class="sa">L</span><span class="s">&#34;hello.png&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">encoderClsid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="c1">//stat = image-&gt;Save(L&#34;hello.jpg&#34;, &amp;encoderClsid, NULL);
</span><span class="c1"></span>
    <span class="k">if</span> <span class="p">(</span><span class="n">stat</span> <span class="o">==</span> <span class="n">Ok</span><span class="p">)</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;hello.png was saved successfully</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    <span class="k">else</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Failure: stat = %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">stat</span><span class="p">);</span>

    <span class="k">delete</span> <span class="n">image</span><span class="p">;</span>
    <span class="n">GdiplusShutdown</span><span class="p">(</span><span class="n">gdiplusToken</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="c1">// By reference:
</span><span class="c1">// https://docs.microsoft.com/en-us/windows/win32/gdiplus/-gdiplus-retrieving-the-class-identifier-for-an-encoder-use
</span><span class="c1"></span><span class="kt">int</span> <span class="nf">GetEncoderClsid</span><span class="p">(</span><span class="k">const</span> <span class="n">WCHAR</span><span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="n">CLSID</span><span class="o">*</span> <span class="n">pClsid</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">UINT</span>  <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>          <span class="c1">// number of image encoders
</span><span class="c1"></span>    <span class="n">UINT</span>  <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>         <span class="c1">// size of the image encoder array in bytes
</span><span class="c1"></span>
    <span class="n">ImageCodecInfo</span><span class="o">*</span> <span class="n">pImageCodecInfo</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

    <span class="n">GetImageEncodersSize</span><span class="p">(</span><span class="o">&amp;</span><span class="n">num</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">size</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>  <span class="c1">// Failure
</span><span class="c1"></span>
    <span class="n">pImageCodecInfo</span> <span class="o">=</span> <span class="p">(</span><span class="n">ImageCodecInfo</span><span class="o">*</span><span class="p">)(</span><span class="n">malloc</span><span class="p">(</span><span class="n">size</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pImageCodecInfo</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>  <span class="c1">// Failure
</span><span class="c1"></span>
    <span class="n">GetImageEncoders</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">pImageCodecInfo</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">UINT</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">num</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">wcscmp</span><span class="p">(</span><span class="n">pImageCodecInfo</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">MimeType</span><span class="p">,</span> <span class="n">format</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="o">*</span><span class="n">pClsid</span> <span class="o">=</span> <span class="n">pImageCodecInfo</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">Clsid</span><span class="p">;</span>
            <span class="n">free</span><span class="p">(</span><span class="n">pImageCodecInfo</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">j</span><span class="p">;</span>  <span class="c1">// Success
</span><span class="c1"></span>        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">free</span><span class="p">(</span><span class="n">pImageCodecInfo</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>  <span class="c1">// Failure
</span><span class="c1"></span><span class="p">}</span>

<span class="cm">/**
</span><span class="cm"> * GDI 截取指定窗口
</span><span class="cm"> *
</span><span class="cm"> * 参数 hwnd   要截屏的窗口句柄
</span><span class="cm"> * 参数 dirPath    截图存放目录
</span><span class="cm"> * 参数 filename 截图名称
</span><span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">CaptureImage</span><span class="p">(</span><span class="n">HWND</span> <span class="n">hwnd</span><span class="p">,</span> <span class="n">CHAR</span><span class="o">*</span> <span class="n">dirPath</span><span class="p">,</span> <span class="n">CHAR</span><span class="o">*</span> <span class="n">filename</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">HDC</span> <span class="n">mdc</span><span class="p">;</span>
    <span class="n">HBITMAP</span> <span class="n">hbmp</span><span class="p">;</span>
    <span class="n">CHAR</span> <span class="n">FilePath</span><span class="p">[</span><span class="n">MAX_PATH</span><span class="p">];</span>
    <span class="n">HDC</span> <span class="n">hdcScreen</span><span class="p">;</span>
    <span class="n">HDC</span> <span class="n">hdcWindow</span><span class="p">;</span>
    <span class="n">HDC</span> <span class="n">hdcMemDC</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">HBITMAP</span> <span class="n">hbmScreen</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">BITMAP</span> <span class="n">bmpScreen</span><span class="p">;</span>
    <span class="n">RECT</span> <span class="n">rcClient</span><span class="p">;</span>
    <span class="n">BITMAPFILEHEADER</span>   <span class="n">bmfHeader</span><span class="p">;</span>
    <span class="n">BITMAPINFOHEADER</span>   <span class="n">bi</span><span class="p">;</span>
    <span class="n">DWORD</span> <span class="n">dwBmpSize</span><span class="p">;</span>
    <span class="n">HANDLE</span> <span class="n">hDIB</span><span class="p">;</span>
    <span class="n">CHAR</span><span class="o">*</span> <span class="n">lpbitmap</span><span class="p">;</span>
    <span class="n">HANDLE</span> <span class="n">hFile</span><span class="p">;</span>
    <span class="n">DWORD</span> <span class="n">dwSizeofDIB</span><span class="p">;</span>
    <span class="n">DWORD</span> <span class="n">dwBytesWritten</span><span class="p">;</span>

    <span class="n">hdcScreen</span> <span class="o">=</span> <span class="n">GetDC</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span> <span class="c1">// 全屏幕DC
</span><span class="c1"></span>    <span class="n">hdcWindow</span> <span class="o">=</span> <span class="n">GetDC</span><span class="p">(</span><span class="n">hwnd</span><span class="p">);</span> <span class="c1">// 截图目标窗口DC
</span><span class="c1"></span>
    <span class="c1">// 创建兼容内存DC
</span><span class="c1"></span>    <span class="n">hdcMemDC</span> <span class="o">=</span> <span class="n">CreateCompatibleDC</span><span class="p">(</span><span class="n">hdcWindow</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hdcMemDC</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">goto</span> <span class="n">done</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// 获取客户端区域用于计算大小
</span><span class="c1"></span>    <span class="n">GetClientRect</span><span class="p">(</span><span class="n">hwnd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">rcClient</span><span class="p">);</span>

    <span class="c1">// 设置延展模式
</span><span class="c1"></span>    <span class="n">SetStretchBltMode</span><span class="p">(</span><span class="n">hdcWindow</span><span class="p">,</span> <span class="n">HALFTONE</span><span class="p">);</span>

    <span class="c1">// 来源 DC 是整个屏幕而目标 DC 是当前的窗口 (HWND)
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">StretchBlt</span><span class="p">(</span><span class="n">hdcWindow</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">rcClient</span><span class="p">.</span><span class="n">right</span><span class="p">,</span> <span class="n">rcClient</span><span class="p">.</span><span class="n">bottom</span><span class="p">,</span>
        <span class="n">hdcScreen</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">GetSystemMetrics</span><span class="p">(</span><span class="n">SM_CXSCREEN</span><span class="p">),</span>
        <span class="n">GetSystemMetrics</span><span class="p">(</span><span class="n">SM_CYSCREEN</span><span class="p">),</span>
        <span class="n">SRCCOPY</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">goto</span> <span class="n">done</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// 通过窗口DC 创建一个兼容位图
</span><span class="c1"></span>    <span class="n">hbmScreen</span> <span class="o">=</span> <span class="n">CreateCompatibleBitmap</span><span class="p">(</span>
        <span class="n">hdcWindow</span><span class="p">,</span>
        <span class="n">rcClient</span><span class="p">.</span><span class="n">right</span> <span class="o">-</span> <span class="n">rcClient</span><span class="p">.</span><span class="n">left</span><span class="p">,</span>
        <span class="n">rcClient</span><span class="p">.</span><span class="n">bottom</span> <span class="o">-</span> <span class="n">rcClient</span><span class="p">.</span><span class="n">top</span>
    <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hbmScreen</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">goto</span> <span class="n">done</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// 将位图块传送到我们兼容的内存DC中
</span><span class="c1"></span>    <span class="n">SelectObject</span><span class="p">(</span><span class="n">hdcMemDC</span><span class="p">,</span> <span class="n">hbmScreen</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">BitBlt</span><span class="p">(</span>
        <span class="n">hdcMemDC</span><span class="p">,</span>   <span class="c1">// 目的DC
</span><span class="c1"></span>        <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>        <span class="c1">// 目的DC的 x,y 坐标
</span><span class="c1"></span>        <span class="n">rcClient</span><span class="p">.</span><span class="n">right</span> <span class="o">-</span> <span class="n">rcClient</span><span class="p">.</span><span class="n">left</span><span class="p">,</span> <span class="n">rcClient</span><span class="p">.</span><span class="n">bottom</span> <span class="o">-</span> <span class="n">rcClient</span><span class="p">.</span><span class="n">top</span><span class="p">,</span> <span class="c1">// 目的 DC 的宽高
</span><span class="c1"></span>        <span class="n">hdcWindow</span><span class="p">,</span>  <span class="c1">// 来源DC
</span><span class="c1"></span>        <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>        <span class="c1">// 来源DC的 x,y 坐标
</span><span class="c1"></span>        <span class="n">SRCCOPY</span><span class="p">))</span>   <span class="c1">// 粘贴方式
</span><span class="c1"></span>    <span class="p">{</span>
        <span class="k">goto</span> <span class="n">done</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// 获取位图信息并存放在 bmpScreen 中
</span><span class="c1"></span>    <span class="n">GetObject</span><span class="p">(</span><span class="n">hbmScreen</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">BITMAP</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">bmpScreen</span><span class="p">);</span>

    <span class="n">bi</span><span class="p">.</span><span class="n">biSize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">BITMAPINFOHEADER</span><span class="p">);</span>
    <span class="n">bi</span><span class="p">.</span><span class="n">biWidth</span> <span class="o">=</span> <span class="n">bmpScreen</span><span class="p">.</span><span class="n">bmWidth</span><span class="p">;</span>
    <span class="n">bi</span><span class="p">.</span><span class="n">biHeight</span> <span class="o">=</span> <span class="n">bmpScreen</span><span class="p">.</span><span class="n">bmHeight</span><span class="p">;</span>
    <span class="n">bi</span><span class="p">.</span><span class="n">biPlanes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">bi</span><span class="p">.</span><span class="n">biBitCount</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
    <span class="n">bi</span><span class="p">.</span><span class="n">biCompression</span> <span class="o">=</span> <span class="n">BI_RGB</span><span class="p">;</span>
    <span class="n">bi</span><span class="p">.</span><span class="n">biSizeImage</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">bi</span><span class="p">.</span><span class="n">biXPelsPerMeter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">bi</span><span class="p">.</span><span class="n">biYPelsPerMeter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">bi</span><span class="p">.</span><span class="n">biClrUsed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">bi</span><span class="p">.</span><span class="n">biClrImportant</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">dwBmpSize</span> <span class="o">=</span> <span class="p">((</span><span class="n">bmpScreen</span><span class="p">.</span><span class="n">bmWidth</span> <span class="o">*</span> <span class="n">bi</span><span class="p">.</span><span class="n">biBitCount</span> <span class="o">+</span> <span class="mi">31</span><span class="p">)</span> <span class="o">/</span> <span class="mi">32</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">bmpScreen</span><span class="p">.</span><span class="n">bmHeight</span><span class="p">;</span>

    <span class="c1">// 在 32-bit Windows 系统上, GlobalAlloc 和 LocalAlloc 是由 HeapAlloc 封装来的
</span><span class="c1"></span>    <span class="c1">// handle 指向进程默认的堆. 所以开销比 HeapAlloc 要大
</span><span class="c1"></span>    <span class="n">hDIB</span> <span class="o">=</span> <span class="n">GlobalAlloc</span><span class="p">(</span><span class="n">GHND</span><span class="p">,</span> <span class="n">dwBmpSize</span><span class="p">);</span>
    <span class="n">lpbitmap</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">GlobalLock</span><span class="p">(</span><span class="n">hDIB</span><span class="p">);</span>

    <span class="c1">// 获取兼容位图的位并且拷贝结果到一个 lpbitmap 中.
</span><span class="c1"></span>    <span class="n">GetDIBits</span><span class="p">(</span>
        <span class="n">hdcWindow</span><span class="p">,</span>  <span class="c1">// 设备环境句柄
</span><span class="c1"></span>        <span class="n">hbmScreen</span><span class="p">,</span>  <span class="c1">// 位图句柄
</span><span class="c1"></span>        <span class="mi">0</span><span class="p">,</span>          <span class="c1">// 指定检索的第一个扫描线
</span><span class="c1"></span>        <span class="p">(</span><span class="n">UINT</span><span class="p">)</span><span class="n">bmpScreen</span><span class="p">.</span><span class="n">bmHeight</span><span class="p">,</span> <span class="c1">// 指定检索的扫描线数
</span><span class="c1"></span>        <span class="n">lpbitmap</span><span class="p">,</span>   <span class="c1">// 指向用来检索位图数据的缓冲区的指针
</span><span class="c1"></span>        <span class="p">(</span><span class="n">BITMAPINFO</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span> <span class="n">bi</span><span class="p">,</span> <span class="c1">// 该结构体保存位图的数据格式
</span><span class="c1"></span>        <span class="n">DIB_RGB_COLORS</span> <span class="c1">// 颜色表由红、绿、蓝（RGB）三个直接值构成
</span><span class="c1"></span>    <span class="p">);</span>


    <span class="n">wsprintf</span><span class="p">(</span><span class="n">FilePath</span><span class="p">,</span> <span class="s">&#34;%s\%s.bmp&#34;</span><span class="p">,</span> <span class="n">dirPath</span><span class="p">,</span> <span class="n">filename</span><span class="p">);</span>

    <span class="c1">// 创建一个文件来保存文件截图
</span><span class="c1"></span>    <span class="n">hFile</span> <span class="o">=</span> <span class="n">CreateFile</span><span class="p">(</span>
        <span class="n">FilePath</span><span class="p">,</span>
        <span class="n">GENERIC_WRITE</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="nb">NULL</span><span class="p">,</span>
        <span class="n">CREATE_ALWAYS</span><span class="p">,</span>
        <span class="n">FILE_ATTRIBUTE_NORMAL</span><span class="p">,</span>
        <span class="nb">NULL</span>
    <span class="p">);</span>

    <span class="c1">// 将 图片头(headers)的大小, 加上位图的大小来获得整个文件的大小
</span><span class="c1"></span>    <span class="n">dwSizeofDIB</span> <span class="o">=</span> <span class="n">dwBmpSize</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">BITMAPFILEHEADER</span><span class="p">)</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">BITMAPINFOHEADER</span><span class="p">);</span>

    <span class="c1">// 设置 Offset 偏移至位图的位(bitmap bits)实际开始的地方
</span><span class="c1"></span>    <span class="n">bmfHeader</span><span class="p">.</span><span class="n">bfOffBits</span> <span class="o">=</span> <span class="p">(</span><span class="n">DWORD</span><span class="p">)</span><span class="k">sizeof</span><span class="p">(</span><span class="n">BITMAPFILEHEADER</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">DWORD</span><span class="p">)</span><span class="k">sizeof</span><span class="p">(</span><span class="n">BITMAPINFOHEADER</span><span class="p">);</span>

    <span class="c1">// 文件大小
</span><span class="c1"></span>    <span class="n">bmfHeader</span><span class="p">.</span><span class="n">bfSize</span> <span class="o">=</span> <span class="n">dwSizeofDIB</span><span class="p">;</span>

    <span class="c1">// 位图的 bfType 必须是字符串 &#34;BM&#34;
</span><span class="c1"></span>    <span class="n">bmfHeader</span><span class="p">.</span><span class="n">bfType</span> <span class="o">=</span> <span class="mh">0x4D42</span><span class="p">;</span> <span class="c1">//BM
</span><span class="c1"></span>
    <span class="n">dwBytesWritten</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">WriteFile</span><span class="p">(</span><span class="n">hFile</span><span class="p">,</span> <span class="p">(</span><span class="n">LPSTR</span><span class="p">)</span><span class="o">&amp;</span> <span class="n">bmfHeader</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">BITMAPFILEHEADER</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">dwBytesWritten</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="n">WriteFile</span><span class="p">(</span><span class="n">hFile</span><span class="p">,</span> <span class="p">(</span><span class="n">LPSTR</span><span class="p">)</span><span class="o">&amp;</span> <span class="n">bi</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">BITMAPINFOHEADER</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">dwBytesWritten</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="n">WriteFile</span><span class="p">(</span><span class="n">hFile</span><span class="p">,</span> <span class="p">(</span><span class="n">LPSTR</span><span class="p">)</span><span class="n">lpbitmap</span><span class="p">,</span> <span class="n">dwBmpSize</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dwBytesWritten</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="c1">// 解锁堆内存并释放
</span><span class="c1"></span>    <span class="n">GlobalUnlock</span><span class="p">(</span><span class="n">hDIB</span><span class="p">);</span>
    <span class="n">GlobalFree</span><span class="p">(</span><span class="n">hDIB</span><span class="p">);</span>

    <span class="c1">// 关闭文件句柄
</span><span class="c1"></span>    <span class="n">CloseHandle</span><span class="p">(</span><span class="n">hFile</span><span class="p">);</span>

    <span class="c1">// 清理资源
</span><span class="c1"></span><span class="nl">done</span><span class="p">:</span>
    <span class="n">DeleteObject</span><span class="p">(</span><span class="n">hbmScreen</span><span class="p">);</span>
    <span class="n">DeleteObject</span><span class="p">(</span><span class="n">hdcMemDC</span><span class="p">);</span>
    <span class="n">ReleaseDC</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">hdcScreen</span><span class="p">);</span>
    <span class="n">ReleaseDC</span><span class="p">(</span><span class="n">hwnd</span><span class="p">,</span> <span class="n">hdcWindow</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
                    <div class="post_footer">
                        
                        <div class="meta">
                            <div class="info">
                                <span class="field tags">
                                    <i class="ri-stack-line"></i>
                                    
                                    <a href="https://huifeng.me/tags/c&#43;&#43;/">C&#43;&#43;</a>
                                    
                                    <a href="https://huifeng.me/tags/c/"> C</a>
                                    
                                    <a href="https://huifeng.me/tags/win32/"> win32</a>
                                    
                                    <a href="https://huifeng.me/tags/screen/"> screen</a>
                                    
                                    <a href="https://huifeng.me/tags/shot/"> shot</a>
                                    
                                    <a href="https://huifeng.me/tags/capture/"> capture</a>
                                    
                                </span>
                            </div>
                        </div>
                        
                    </div>
                </div>
                
                
                
<div class="doc_comments">
    <div class="comments_block_title">发表评论</div>
    <div id="vcomments"></div>
</div>

<link rel="stylesheet" href="https://huifeng.me/css/comments.css" />
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine/dist/Valine.min.js'></script>

<script type="text/javascript">
    new Valine({
        el: '#vcomments',
        appId: 'yusajl3uDsnB888cn1ulQeKz-gzGzoHsz',
        appKey: 'jYjHeNB1qVYREHe1zX4bRx7z',
        placeholder: ' ',
        visitor: 'true',
    })
</script>
                
            </div>
        </div>
    </div>
    <a id="back_to_top" href="#" class="back_to_top"><i class="ri-arrow-up-s-line"></i></a>
    <footer class="footer">
    <div class="powered_by">
        <a href="https://varkai.com">Designed by VarKai,</a>
        <a href="http://www.gohugo.io/">Proudly published with Hugo</a>
    </div>

    <div class="footer_slogan">
        <span>&gt;_ Simple Is Correct.</span>
    </div>
</footer>
    <div id="fastSearch">
   <input id="searchInput" tabindex="0">
   <ul id="searchResults">
   </ul>
 </div>
 <script src="/js/fuse.js"></script> 
 <script src="/js/fastsearch.js"></script>
<script src="https://huifeng.me/js/jquery-3.5.1.min.js"></script>
<link href="https://huifeng.me/css/fancybox.min.css" rel="stylesheet">
<script src="https://huifeng.me/js/fancybox.min.js"></script>
<script src="https://huifeng.me/js/zozo.js"></script>


<script type="text/javascript" async
    src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\[\[', '\]\]']],
                processEscapes: true,
                processEnvironments: true,
                skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
                TeX: {
                    equationNumbers: { autoNumber: "AMS" },
                    extensions: ["AMSmath.js", "AMSsymbols.js"]
                }
            }
        });

        MathJax.Hub.Queue(function () {
            
            
            
            var all = MathJax.Hub.getAllJax(), i;
            for (i = 0; i < all.length; i += 1) {
                all[i].SourceElement().parentNode.className += ' has-jax';
            }
        });
    </script>

<style>
    code.has-jax {
        font: inherit;
        font-size: 100%;
        background: inherit;
        border: inherit;
        color: #515151;
    }
</style>




</body>

</html>